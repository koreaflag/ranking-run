# RUNVS API — Caddy reverse proxy with automatic HTTPS
#
# DNS A record: api.runvs.run → server IP
# Caddy auto-provisions Let's Encrypt SSL certificate

api.runvs.run {
	# Reverse proxy to FastAPI backend
	reverse_proxy backend:8000

	# Response headers
	header {
		# Security headers
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Referrer-Policy strict-origin-when-cross-origin
		# Remove server identity
		-Server
	}

	# Gzip compression
	encode gzip

	# Access logging
	log {
		output stdout
		format json
	}
}

# Health check / fallback on port 80
:80 {
	respond /health "OK" 200

	# Also proxy API requests over HTTP (for initial setup / debugging)
	reverse_proxy /api/* backend:8000
}
