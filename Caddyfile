# RUNVS API â€” Caddy reverse proxy with automatic HTTPS
#
# Usage:
#   1. Set DOMAIN env var or replace api.runvs.app below
#   2. DNS A record must point to this server's IP
#   3. Caddy auto-provisions Let's Encrypt SSL certificate
#
# Development: use localhost for local testing (self-signed cert)
# Production:  use your actual domain (auto Let's Encrypt)

{$DOMAIN:api.runvs.app} {
	# Reverse proxy to FastAPI backend
	reverse_proxy backend:8000

	# Response headers
	header {
		# Security headers
		X-Content-Type-Options nosniff
		X-Frame-Options DENY
		Referrer-Policy strict-origin-when-cross-origin
		# Remove server identity
		-Server
	}

	# Gzip compression
	encode gzip

	# Access logging
	log {
		output stdout
		format json
	}
}

# Health check on port 80 (for load balancer)
:80 {
	respond /health "OK" 200
}
